
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@section head{
    @Styles.Render("~/bundles/ztreecss")
}






<ul id="treeDemo" class="nav ztree"></ul>














@section Scripts {
@Scripts.Render("~/bundles/ztreejs")
<script type="text/javascript">










    var setting = {
        view: {
            selectedMulti: false
        },
        edit: {
            enable: true,
            showRemoveBtn: remove,
            showRenameBtn: false
        },
        data: {
            keep: {
                parent: true,
                leaf: true
            },
            simpleData: {
                enable: true
            }
        },
        callback: {
            beforeRemove: beforeRemove,
            onRemove: onRemove,
            beforeClick: beforeClick,
            onClick: onClick
        }
    };







    function setzNodes(data) {
        var zNodes = [];
        var result = data;
        $.each(data, function (i, item) {
            var picourl = item.IconUrl == "" ? "/Content/ztree/css/zTreeStyle/img/diy/1_open.png" : item.IconUrl;
            var cicourl = item.IconUrl == "" ? "/Content/ztree/css/zTreeStyle/img/diy/3.png" : item.IconUrl;
            if (item.ParentId == 0) {
                zNodes.push({ id: item.Id, pId: 0, name: item.Name, open: true, icon: picourl });
            } else {
                zNodes.push({ id: item.Id, pId: item.ParentId, name: item.Name, icon: cicourl });
            }
        });
        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
    }

    function reloadtree() {
        doAjaxRequest({ url: "@Url.Action("GetCategories", "Category")", callback: setzNodes });
    }







    function doAjaxRequest(opt) {
        var optdata = null;
        if (opt.data != null) {
            optdata = opt.data;
        }
        $.ajax({
            url: opt.url,
            type: "POST",
            data: optdata,
            dataType: "json",
            cache: false,
            success: opt.callback,
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert("系统出现异常，请联系管理员！");
            }
        });
    }



    $(function ()
    {
        doAjaxRequest({ url: "@Url.Action("GetCategories", "Category")", callback: setzNodes });
    })


</script>
    }


